---
title: 'Entrega: Tarea 3'
author: "Laura Basalo Tur, Camila Pérez Arévalo, Josep Roman Cardell"
output:
  pdf_document: default
  html_document: default
---


```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.align="center", echo=TRUE, warning=FALSE, message=FALSE,autodep = TRUE,cache=TRUE)
library(knitr)
library(printr)
library(igraph)
```

**1. Implementar el calculo de las matrices de los núcleos de Neumann. La función debería tener dos parámetros: la matriz de adyacencia y el grado de difusión.**



```{r}

neumann_kernel = function(A, grado){
  At = t(A)
  K = At %*% A
  Ter = A %*% At
  K_hat = K %*% solve(diag(100)-grado*K)
  T_hat = Ter %*% solve(diag(100)-grado*Ter)

  list_result = list(K_hat, T_hat)
  
  return(list_result)
}



```

**2. Aplicar el algoritmo a la matriz de adyacencia de páginas webs: webPageLinks.txt. Responda, con estos datos, el ejercicio 6.7 del libro.**

```{r}
#Leemos la matriz del fichero txt
A = as.matrix(read.table("data/webPageLinks.txt"))

#Generamos el grafo a partir de la matriz
G = graph_from_adjacency_matrix(A)

#Calculamos el grado de difusión
d_out = max(degree(G, mode = "out"))
d_in = max(degree(G, mode = "in"))
grado = runif(1, 0, 1/min(c(d_out, d_in)))

matrix_result = neumann_kernel(A, grado)
K_hat = matrix_result[[1]]
T_hat = matrix_result[[2]]
```


**7.(a) Describe how the HITS algorithm relates to the Neumann Kernel technique.**

La técnica del núcleo de Neumman demuestra que el algoritmo de HITS se puede generalizar y conseguir así un mecanismo eficiente que determina la relación y la importancia entre los vértices de un grafo. 

Cuando el grado de difusión es grande se incrementa la importancia de los vértices más alejados del grafo, por lo que la solución que proporciona el kernel de Neumman  es muy similar o igual a la puntuación que calcula el algoritmo de HITS. 

Josep: NK es una generalización del algoritmo de HITS. Por consecuencia, la authority score está relacionada con el score de la matriz K_{\gamma} y el hub score con el score de la matriz T_{\gamma}. Esta relación se puede observar en cuanto que si se crea un ranking de los nodos atendiendo a su authority score y a su K score, el orden de los nodos será el mismo. Además, si se anula el factor de difusión y usamos un una $\gamma = 1$ los score serán los mismos. (Eso dice la teoría, se tendría que comprobar) 

```{r}
matrix_result = neumann_kernel(A, grado)
K_hat1 = matrix_result[[1]]
T_hat1 = matrix_result[[2]]

Kscore1 = rowSums(K_hat1) #El score del nodo i es la suma de la fila ith.
Tscore1 = rowSums(T_hat1) 

#Gamma Máxima
matrix_result = neumann_kernel(A, grado=1/min(c(d_out, d_in)))
K_hat2 = matrix_result[[1]]
T_hat2 = matrix_result[[2]]

Kscore2 = rowSums(K_hat2) #Da valores negativos
Tscore2 = rowSums(T_hat2) 

# HITS (Mirar correlaciones entre scores, si los rankings son iguales y si ambas puntuaciones convergen con gammas elevada)
...
```


**7.(b) How does the decay factor γ affect the output of the Neumann Kernel algorithm?**

El grado de difusión ($\gamma$) debe ser menor a $\frac{1}{\gamma_{m}}$

Josep: El efecto del factor de difusión es el de dar de cada vez menos importancia cuanto más lejos está la conexión entre dos nodos. Es decir, tiene más peso la conexióne entre dos nodos directamente conectados que los que tinene n eristas entre ellos.    La teoria dice que las matrices de KN converge si $\gamma \geq \frac{1}{min(\Delta^-,\Delta^+)}$, donde $\Delta^-$ es el máximo grado entrada grafo y $\Delta^+$ es el máximo grado salida grafo. Cuando se elige un valor elevado de $\gamma$ la matriz $K_{\gamma}$ equivale a HITS
